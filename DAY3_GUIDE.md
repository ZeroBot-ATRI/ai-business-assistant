# Day 3 UI优化 - 使用指南

## 新增功能

### 1. 增强版聊天界面 (ui/app_enhanced.py)

#### 主要改进
- ✅ **宽屏布局** - 更好的空间利用
- ✅ **会话统计面板** - 实时显示成功率、平均耗时等
- ✅ **自定义CSS样式** - 更美观的界面
- ✅ **详细的执行信息** - Metric卡片展示意图、技能、执行时间
- ✅ **更多测试场景** - 6个快速测试按钮（订单3个+库存3个）
- ✅ **使用说明** - 内置帮助文档

#### 核心功能
1. **聊天交互**
   - 输入框支持多行输入
   - 实时显示AI思考状态
   - 成功/失败状态明确反馈

2. **统计面板**（右侧）
   - 本次会话总请求数
   - 成功数和成功率
   - 平均响应时间
   - 系统今日统计

3. **快速测试**（侧边栏）
   - **订单场景**：
     - 正常订单（12345）
     - 延迟订单（999）
     - 待发货订单（888）
   - **库存场景**：
     - 库存充足（产品A）
     - 库存不足（产品B）
     - 缺货产品（产品C）

### 2. 监控看板 (ui/dashboard.py)

#### 核心功能
1. **核心指标卡片**
   - 今日处理量（带趋势）
   - 成功率（带delta）
   - 平均响应时间
   - 今日成本

2. **实时告警**
   - 成功率低于90%告警
   - 响应时间超过2s告警
   - 自动分级（严重/警告/提示）

3. **趋势图表**
   - 意图分布饼图（最近7天）
   - 24小时处理量趋势线

4. **决策日志**
   - 最近10条记录
   - 包含用户输入、意图、执行动作、状态

5. **SOP统计**
   - SOP执行次数
   - 成功率进度条
   - 平均耗时

6. **自动刷新**
   - 可选30秒自动刷新
   - 手动刷新按钮
   - 数据缓存30秒

---

## 启动方式

### 方式1：一键启动（推荐）

**Windows:**
```bash
start_all.bat
```

**Linux/Mac:**
```bash
chmod +x start_all.sh
./start_all.sh
```

这会同时启动：
- 后端API（端口8000）
- 聊天界面（端口8501）
- 监控看板（端口8502）

### 方式2：手动启动

**终端1 - 后端：**
```bash
venv\Scripts\activate
uvicorn app.main:app --reload
```

**终端2 - 聊天界面：**
```bash
venv\Scripts\activate
streamlit run ui/app_enhanced.py
```

**终端3 - 监控看板：**
```bash
venv\Scripts\activate
streamlit run ui/dashboard.py --server.port 8502
```

---

## 访问地址

| 服务 | 地址 | 说明 |
|-----|------|------|
| 后端API | http://localhost:8000 | FastAPI接口 |
| API文档 | http://localhost:8000/docs | Swagger UI |
| 聊天界面 | http://localhost:8501 | Streamlit界面 |
| 监控看板 | http://localhost:8502 | 数据可视化 |

---

## 使用演示

### 场景1：查询正常订单

1. 打开聊天界面：http://localhost:8501
2. 点击侧边栏"查询正常订单"按钮
3. 或输入："查询订单12345的状态"
4. 查看执行详情，了解AI识别过程

**预期结果：**
- 意图：查询订单状态
- 技能：get_order
- 结果：订单已发货，物流单号SF1234567890

### 场景2：查询延迟订单

1. 点击"查询延迟订单"或输入："查询订单999的状态"
2. 查看AI返回的延迟信息

**预期结果：**
- 状态：配送延迟
- 原因：天气原因
- 物流单号：YT9876543210

### 场景3：查询缺货产品

1. 点击"查询缺货产品"或输入："产品C还有多少库存？"
2. 查看库存不足的处理

**预期结果：**
- 库存：0件
- 状态：缺货
- 仓库：北京仓

### 场景4：查看监控看板

1. 打开监控看板：http://localhost:8502
2. 查看今日处理量、成功率等核心指标
3. 查看意图分布饼图
4. 查看最近决策日志

---

## 新增的测试按钮

### 订单测试（3个）
1. **查询正常订单** - 订单12345
2. **查询延迟订单** - 订单999（配送延迟）
3. **查询待发货订单** - 订单888

### 库存测试（3个）
1. **查询正常库存** - 产品A（库存充足）
2. **查询库存不足** - 产品B（库存15件）
3. **查询缺货产品** - 产品C（缺货）

---

## UI对比

### 旧版 (ui/app.py)
- 简单的单列布局
- 基础的消息展示
- 2个测试按钮
- 无统计面板

### 新版 (ui/app_enhanced.py)
- 宽屏三列布局（主内容+统计面板）
- 自定义CSS美化
- 6个测试场景按钮
- 实时统计面板
- 详细的执行信息展示
- 内置使用说明

### 监控看板 (ui/dashboard.py)
- 全新独立页面
- 核心指标卡片
- 实时告警系统
- 图表可视化（饼图、折线图）
- 决策日志表格
- 自动刷新功能

---

## 性能优化

1. **数据缓存**
   - 监控看板指标缓存30秒
   - 减少API调用频率

2. **异步加载**
   - 后端状态异步检查
   - 避免阻塞主界面

3. **智能刷新**
   - 只在数据变化时更新
   - 可选自动刷新（30秒）

---

## 常见问题

### Q1: 聊天界面显示"后端未连接"？
**A**: 确保后端已启动：
```bash
uvicorn app.main:app --reload
```

### Q2: 监控看板数据为空？
**A**: 需要先使用聊天界面进行几次对话，生成数据后再查看。

### Q3: 如何同时打开所有界面？
**A**: 使用一键启动脚本：
- Windows: `start_all.bat`
- Linux/Mac: `./start_all.sh`

### Q4: 端口被占用怎么办？
**A**: 修改启动命令中的端口号：
```bash
streamlit run ui/app_enhanced.py --server.port 8503
```

### Q5: 如何停止所有服务？
**A**:
- Windows: 关闭对应的命令行窗口
- Linux/Mac: 使用启动时显示的PID
  ```bash
  kill [PID]
  ```

---

## 下一步计划

### Day 4-5: 真实API对接
- 替换Mock技能为真实API调用
- 对接订单系统
- 对接库存系统
- 集成邮件服务

### Day 6-8: AI Orchestrator
- 实现多步骤编排
- 支持复杂业务流程

### Day 16-17: SOP引擎
- 自动化标准操作流程
- YAML配置化

---

## 技术细节

### CSS自定义
- 主标题样式
- 统计卡片样式
- 告警卡片样式
- 渐变色背景

### Plotly图表
- 饼图：意图分布
- 折线图：24小时趋势
- 交互式hover
- 响应式布局

### Streamlit组件
- st.metric - 指标卡片
- st.expander - 可折叠区域
- st.columns - 多列布局
- st.cache_data - 数据缓存

---

**Day 3 UI优化完成！现在系统有了专业的界面和监控能力。** 🎨
